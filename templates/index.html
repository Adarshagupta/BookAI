<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Book Generator</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#3b82f6',
                        secondary: '#10b981',
                    },
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    },
                },
            },
        }
    </script>
</head>
<body class="font-sans text-gray-800 bg-gray-50 min-h-screen flex flex-col">
    <header class="bg-white shadow-sm">
        <nav class="container mx-auto px-4 py-4">
            <div class="flex justify-between items-center">
                <a href="#" class="text-2xl font-bold text-primary">AI Book Generator</a>
                <div class="space-x-4">
                    <a href="#" class="text-gray-600 hover:text-primary">Home</a>
                    <a href="#" class="text-gray-600 hover:text-primary">About</a>
                    <a href="#" class="text-gray-600 hover:text-primary">Contact</a>
                </div>
            </div>
        </nav>
    </header>

    <main class="flex-grow container mx-auto px-4 py-10">
        <div class="flex flex-col lg:flex-row max-w-6xl mx-auto gap-10">
            <div class="w-full lg:w-1/2 bg-white p-8 rounded-lg shadow-sm">
                <h1 class="text-3xl font-bold text-gray-800 mb-6">Generate Your AI Book</h1>
                <form id="book-form" class="space-y-6">
                    <div>
                        <label for="api_key" class="block mb-2 text-sm font-medium text-gray-700">OpenAI API Key</label>
                        <input type="password" id="api_key" name="api_key" required class="w-full p-3 border border-gray-300 rounded-md focus:ring-2 focus:ring-primary focus:border-transparent transition">
                    </div>
                    <div>
                        <label for="model" class="block mb-2 text-sm font-medium text-gray-700">Model</label>
                        <select id="model" name="model" required class="w-full p-3 border border-gray-300 rounded-md focus:ring-2 focus:ring-primary focus:border-transparent transition">
                            <option value="gpt-3.5-turbo">GPT-3.5 Turbo</option>
                            <option value="gpt-4o-mini">GPT-4o Mini</option>
                            <option value="gpt-4o-mini-2024-07-18">GPT-4o Mini (2024-07-18)</option>
                        </select>
                    </div>
                    <div>
                        <label for="language" class="block mb-2 text-sm font-medium text-gray-700">Language</label>
                        <select id="language" name="language" required class="w-full p-3 border border-gray-300 rounded-md focus:ring-2 focus:ring-primary focus:border-transparent transition">
                            <option value="english">English</option>
                            <option value="hindi">Hindi(Experimental)</option>
                            <option value="spanish">Spanish</option>
                        </select>
                    </div>
                    <div>
                        <label for="topic" class="block mb-2 text-sm font-medium text-gray-700">Book Topic</label>
                        <input type="text" id="topic" name="topic" required class="w-full p-3 border border-gray-300 rounded-md focus:ring-2 focus:ring-primary focus:border-transparent transition">
                    </div>
                    <div>
                        <label for="word_count" class="block mb-2 text-sm font-medium text-gray-700">Target Word Count</label>
                        <input type="number" id="word_count" name="word_count" value="10000" required class="w-full p-3 border border-gray-300 rounded-md focus:ring-2 focus:ring-primary focus:border-transparent transition">
                    </div>
                    <button type="submit" class="w-full bg-primary text-white py-3 rounded-md hover:bg-blue-600 transition font-medium">Generate Book</button>
                </form>
                <div id="progress" class="mt-4 text-secondary text-center"></div>
                <div id="error-message" class="mt-4 p-4 bg-red-100 text-red-700 rounded-md text-center font-medium hidden"></div>
            </div>
            <div class="w-full lg:w-1/2 bg-white shadow-sm rounded-lg overflow-hidden">
                <div class="h-[600px] p-8 overflow-auto">
                    <div class="page-content"></div>
                </div>
            </div>
        </div>
    </main>

    <div class="loading fixed inset-0 bg-white bg-opacity-80 backdrop-blur-sm flex justify-center items-center z-50 hidden">
        <div class="text-center text-primary">
            <div class="inline-block w-10 h-10 border-4 border-primary border-t-transparent rounded-full animate-spin mb-4"></div>
            <p>Generating your book...</p>
        </div>
    </div>

    <div id="ad-wall" class="fixed inset-0 bg-black bg-opacity-50 flex justify-center items-center z-50 hidden">
        <div class="bg-white p-8 rounded-lg shadow-lg max-w-2xl w-full relative">
            <h2 class="text-2xl font-bold mb-4">Advertisement</h2>
            <p class="mb-4">This is an advertisement. You can close this ad in <span id="countdown">30</span> seconds.</p>
            <p id="ad-reason" class="mb-4 text-sm text-gray-600"></p>
            <div id="ad-content" class="mb-4">
                <!-- Add your advertisement content here -->
                <img src="https://via.placeholder.com/800x400" alt="Advertisement" class="w-full h-auto">
            </div>
            <button id="close-ad" class="absolute top-2 right-2 text-gray-500 hover:text-gray-700 hidden">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                </svg>
            </button>
        </div>
    </div>

    <button id="download-pdf" class="fixed bottom-5 right-5 bg-secondary text-white px-6 py-3 rounded-full shadow-lg hover:bg-green-600 transition transform hover:-translate-y-1 hidden">
        Download Your Book
    </button>

    <footer class="bg-white border-t">
        <div class="container mx-auto px-4 py-6">
            <p class="text-center text-gray-600">Â© 2024 AI Book Generator. All rights reserved.</p>
        </div>
    </footer>

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
        $(document).ready(function() {
            // Load saved API key
            var savedApiKey = localStorage.getItem('openai_api_key');
            if (savedApiKey) {
                $('#api_key').val(savedApiKey);
            }

            $('#book-form').submit(function(e) {
                e.preventDefault();
                // Save API key
                localStorage.setItem('openai_api_key', $('#api_key').val());
                showAdWall('generate');
            });

            function showAdWall(action) {
                $('#ad-wall').removeClass('hidden');
                var countdown = 5;
                var adReason = "";

                if ($('#model').val() === 'gpt-3.5-turbo') {
                    countdown = 30;
                    adReason = "You've selected GPT-3.5 Turbo, which requires a longer processing time.";
                }

                if (parseInt($('#word_count').val()) > 1000) {
                    countdown = 50;
                    adReason = "You've requested over 1000 words, which requires more processing time.";
                }

                $('#countdown').text(countdown);
                $('#ad-reason').text(adReason);

                var countdownInterval = setInterval(function() {
                    countdown--;
                    $('#countdown').text(countdown);
                    if (countdown <= 0) {
                        clearInterval(countdownInterval);
                        $('#close-ad').removeClass('hidden');
                    }
                }, 1000);

                $('#close-ad').off('click').on('click', function() {
                    $('#ad-wall').addClass('hidden');
                    if (action === 'generate') {
                        generateBook();
                    } else if (action === 'download') {
                        downloadPDF();
                    }
                });
            }

            function generateBook() {
                var formData = $('#book-form').serialize();
                $('#progress').text('');
                $('.page-content').empty();
                $('.loading').show();
                $('#download-pdf').hide();
                $('#error-message').hide();
                
                $.ajax({
                    url: '/generate',
                    method: 'POST',
                    data: formData,
                    success: function(response) {
                        $('.loading').hide();
                        $('.page-content').html(response.content);
                        $('#progress').text('Book generated! Word count: ' + response.word_count);
                        $('#download-pdf').show();
                    },
                    error: function(xhr, status, error) {
                        $('.loading').hide();
                        $('#error-message').text('An error occurred while generating the book: ' + error).show();
                    }
                });
            }

            $('#download-pdf').click(function() {
                showAdWall('download');
            });

            function downloadPDF() {
                var content = $('.page-content').html();
                var title = $('#topic').val();
                var language = $('#language').val();
                $('.loading').show();
                $('#error-message').hide();
                
                $.ajax({
                    url: '/download-pdf',
                    method: 'POST',
                    contentType: 'application/json',
                    data: JSON.stringify({content: content, title: title, language: language}),
                    xhrFields: {
                        responseType: 'blob'
                    },
                    success: function(blob) {
                        $('.loading').hide();
                        var link = document.createElement('a');
                        link.href = window.URL.createObjectURL(blob);
                        link.download = title + ".pdf";
                        link.click();
                    },
                    error: function(xhr, status, error) {
                        $('.loading').hide();
                        var errorMessage = 'An error occurred while generating the PDF.';
                        if (xhr.responseJSON && xhr.responseJSON.error) {
                            errorMessage += ' Details: ' + xhr.responseJSON.error;
                        }
                        $('#error-message').text(errorMessage).show();
                    }
                });
            }
        });
    </script>
</body>
</html>